<html>
   <head>
      <meta HTTP-EQUIV='Pragma' CONTENT='no-cache'>
	  <meta http-equiv="refresh" content="<%ejGet(timeout_refresh)%>">
         <link rel="stylesheet" href="main_router.css" type='text/css'>

		<%ejGet("curLanguage")%>
		<SCRIPT>assign_var();</SCRIPT>

		 
            <script language="javascript" src="util.js"></script>
			<SCRIPT language=JavaScript src="showMenu.js"></SCRIPT>
            <script language="javascript">
<!-- hide
strHtml='<title>'+wlm_1+' &gt; WDS</title>';
dw(strHtml);

var enbl = '<%ejGetWl(wlEnbl)%>';
var mode = '<%ejGetWl(wlMode)%>';
var lazywds = '<%ejGetWl(wlLazyWds)%>';
var wds = new Array( '<%ejGetWl(wlWds0)%>', '<%ejGetWl(wlWds1)%>', '<%ejGetWl(wlWds2)%>', '<%ejGetWl(wlWds3)%>' );
var staInfo = '<%ejGetWl(staInfo)%>';


var afterburneren = '<%ejGetWl(wlAfterBurnerEn)%>' ; 


function hideStaticWds(hide) {
   var status = 'visible';
   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)
      document.getElementById('staticWds').style.visibility = status;
   else {
      if (document.layers) {
         with ( document.forms[0] ) {
            if ( hide == 1 ) {
               for ( i = 0; i < 4; i++ )
                  wlwds[i].value = '';
            } else {
               for ( i = 0; i < 4; i++ )
                  wlwds[i].value = wds[i];
            }
         }
      } else
         document.all.staticWds.style.visibility = status;
   }
}

function hideDynamicWds(hide) {
   var status = 'visible';
   if ( hide == 1 )
      status = 'hidden';
   if (document.getElementById)
      document.getElementById('dynamicWds').style.visibility = status;
   else {
      if (document.layers) {
      } else
         document.all.dynamicWds.style.visibility = status;
   }
}

function refreshClick() {
   var lst = '';
   with ( document.forms[0] ) {
      var idx = wllazywds.selectedIndex
      var restrict = wllazywds[idx].value;
      if (restrict != '2') {
         alert('Refresh only allowed when Bridge Restrict has "Enabled(Scan)" selected.');
         return;
      }
      lst += '&wlMode=' + wlMode.options[wlMode.selectedIndex].value;
      lst += '&wlLazyWds=' + restrict;
   }
   var loc = 'wlwds.cmd?action=scan' + lst;

   var code = 'location="' + loc + '"';
   eval(code);
   
}

function wl_recalc(OnPageLoad) {
   var ret=true;
   with ( document.forms[0] ) {
       if(OnPageLoad==0) {
       }
   }
   return ret;
}

function BridgeRestrictChange(OnPageLoad) {
   with ( document.forms[0] ) {
      var restrict = wllazywds[wllazywds.selectedIndex].value;
      if ( wl_recalc(OnPageLoad) == false) return; 

      switch ( restrict ) {
      case '0':
         hideDynamicWds(1);
         hideStaticWds(0);
         break;
      case '1':
         hideDynamicWds(1);
         hideStaticWds(1);
         break;
      case '2':
         refreshClick();
         break;
      }
   }
}

function parseRestrictIndex(restrict) {
   var ret;
      switch(restrict) {
      case '0':
         ret = 0;
         break;
      case '2':
         ret = 1;
         break;
      default:
         //ret = 2;		//Alex : mark for Auto
		 ret = 1;
         break;
   }
   return ret;
}

function frmLoad() {
   with ( document.forms[0] ) {
      if ( mode == 'ap' )
         wlMode.selectedIndex = 0;
      else
         wlMode.selectedIndex = 1;

      wllazywds.selectedIndex = parseRestrictIndex(lazywds);

      for ( i = 0; i < 4; i++ )
         wlwds[i].value = wds[i];

      if (wllazywds.selectedIndex == 1) {
         hideDynamicWds(0);
         hideStaticWds(1);
      } else
         BridgeRestrictChange(1);
   }
}

function btnApply() {
   var loc = 'wlwds.cmd?action=save';

   var idx;

   if ( enbl == '0' ) {
      alert('Cannot apply the change since wireless is currently disabled.');
      return;
   }

   with ( document.forms[0] ) {
      var idx;
      var restrict;
      idx = wlMode.selectedIndex;
      loc += '&wlMode=' + wlMode.options[idx].value;
      idx = wllazywds.selectedIndex;
      loc += '&wlLazyWds=' + wllazywds.options[idx].value;
      restrict = wllazywds.options[idx].value;
      switch ( restrict ) {
      case '0':
         for ( i = 0; i < 4; i++ ) {
            if ( wlwds[i].value != '' && isValidMacAddress(wlwds[i].value) == false ) {
               msg = 'Remote Bridge MAC address "' + wlwds[i].value + '" is invalid MAC address.';
               alert(msg);
               return;
            }
            loc += '&wlWds' + i + '=';
            loc += wlwds[i].value;
         }
         break;
      case '2':
	     if(wdsnum.value > 0)
		 {
			 var lst = '';
			 if (scanwds.length > 0)
				for (i = 0; i < scanwds.length; i++) {
				   if ( scanwds[i].checked == true )
					  lst += scanwds[i].value + ', ';
				}
			 else if ( scanwds.checked == true )
				lst = scanwds.value;
			 loc += '&wdsLst=' + lst;
		 }
		 else
		 {
		 	alert("No remote bridges MAC address choosed! Please refresh page again.");
		 	retrun;
		 }
         break;
      case '1':
         break;
      }
   }

   var code = 'location="' + loc + '"';
   eval(code);
}

<!-- hide

// done hiding -->
</script>
</head>
<body onLoad='frmLoad()' bgColor="#ffffff" leftMargin="0" topMargin="0" marginheight="0" marginwidth="0">
<form>
       <SCRIPT language=JavaScript>
	var helpItem 	='WDS';
	var menuSection	='WLAN';
	var menuItem	='WDS';
	var isAPmode = '<%ejGet(enblNat)%>';
		
	var wanStatus = '<%ejGetOther(isUp)%>';
	showHead(wanStatus,helpItem);
	showMenu(menuSection,menuItem,isAPmode)
	</SCRIPT>  
<TD class=head_bold width="90%" valign="top"><Br>

<b><font class="head_bold">&nbsp;&nbsp;<script>dw(wlm_1);</script> &gt; Bridge</font></b>
<br><br>
<table border="0" cellpadding="0" cellspacing="0" width="737">
<tr>
	<td width="31"></td>
	<td width="706" class="copy_1">
This page allows you to configure wireless bridge features of the wireless LAN
interface. You can select Wireless Bridge (also known as Wireless Distribution
System) to disables acess point functionality. Selecting Acess Point enables
access point functionality. Wireless bridge functionality will still be
available and wireless stations will be able to associate to the AP. Select
Disabled in Bridge Restrict which disables wireless bridge restriction. Any
wireless bridge will be granted access. Only those bridges selected in
Remote Bridges will be granted access.<br>
</td>
</tr>
</table>


<table border='0' cellpadding='4' cellspacing='0'>
   <tr>
   	  <td width="21"></td>
      <td width='103' class="copy_1">AP Mode:</td>
      <td width="198" class="copy_1"><select name='wlMode' size="1" onChange="wl_recalc(0);">
            <option value="ap">Access Point</option>
            <option value="wds">Wireless Bridge</option>
      </select></td>
   </tr>
   <tr>
   	  <td></td>
      <td class="copy_1">Bridge Restrict:</td>
      <td class="copy_1"><select name='wllazywds' size='1' onChange='BridgeRestrictChange(0);'>
            <option value="0">Manual</option>
            <!--<option value="2">Auto</option>//-->
            <option value="1">Disabled</option>
      </select></td>
   </tr>
</table>
</div>

<div id='staticWds'>
   <table width="535" border='0' cellpadding='4' cellspacing='0'>
      <tr>
	  	 <Td width="22"></Td>
         <td width='187' class="copy_1">Remote Bridges MAC Address:</td> 
         <td width="144" class="copy_1"><input type='text' name='wlwds' onChange="wl_recalc(0);"></td>
         <td width="150" class="copy_1"><input type='text' name='wlwds' onChange="wl_recalc(0);"></td>
      </tr>
      <tr>
	  	 <td></td>
         <td width='187'></td>
         <td><input type='text' name='wlwds' onChange="wl_recalc(0);"></td>
         <td><input type='text' name='wlwds' onChange="wl_recalc(0);"></td>
      </tr>
   </table>
</div>

<div id='dynamicWds'>
<%ejGetWl(dynamicWds)%>
</div>
<br><br>

<table width="618" border="0" cellpadding="0" cellspacing="0">
<tr>
	<td width="133"></td>
	<td width="485">
					<script>
						var info ="<input type='button' style='height:22px;width:180px;' class='submitBtn' onClick='frmLoad()' value='"+wd_9+"'><input type='button' style='height:22px;width:180px;' class='submitBtn' onClick='btnApply()' value='"+wd_10+"'>";										
						dw(info);
					</script>	
	</td>
</tr>
</table>

</TD></TR></TBODY></TABLE></TD></form>
</body>
</html>
